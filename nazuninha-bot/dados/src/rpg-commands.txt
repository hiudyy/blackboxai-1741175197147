// ==================== COMANDOS RPG ====================
// Adicione esses comandos dentro do switch(command):

// Comandos de Loja e InventÃ¡rio
case 'loja':
case 'shop': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const player = await checkRPGAction(sender);
    const shopList = formatShop(player);
    reply(shopList);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'habilidades':
case 'skills': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const player = await checkRPGAction(sender);
    const skillList = formatSkills(player);
    reply(skillList);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'comprar':
case 'buy': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o ID do item que deseja comprar. Use /loja para ver os itens disponÃ­veis!');
  
  try {
    const player = await checkRPGAction(sender);
    const item = purchaseItem(sender, q.toLowerCase());
    reply(`ğŸ›ï¸ *COMPRA REALIZADA!*\n\n${item.emoji} VocÃª comprou: ${item.name}\nğŸ’° Custou: R$ ${item.price}\n\n_Use /inventario para ver seus itens!_`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'aprender':
case 'learn': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o ID da habilidade que deseja aprender. Use /habilidades para ver as opÃ§Ãµes!');
  
  try {
    const player = await checkRPGAction(sender);
    const skill = learnSkill(sender, q.toLowerCase());
    reply(`âœ¨ *NOVA HABILIDADE!*\n\n${skill.emoji} VocÃª comeÃ§ou a treinar: ${skill.name}\n\n_O treinamento levarÃ¡ 10 minutos..._\n_Durante este tempo vocÃª nÃ£o poderÃ¡ realizar outras aÃ§Ãµes!_`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'usar':
case 'use': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o ID do item que deseja usar. Use /inventario para ver seus itens!');
  
  try {
    const player = await checkRPGAction(sender);
    const item = useInventoryItem(sender, q.toLowerCase());
    reply(`âœ¨ *ITEM USADO!*\n\n${item.emoji} VocÃª usou: ${item.name}\n\n_O efeito foi aplicado com sucesso!_`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'inventario':
case 'inventory':
case 'inv': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const player = await checkRPGAction(sender);
    
    if (!player.inventory?.length) {
      reply('ğŸ’ Seu inventÃ¡rio estÃ¡ vazio!\n\nUse /loja para comprar itens!');
      return;
    }

    let text = `ğŸ’ *SEU INVENTÃRIO* ğŸ’\n\n`;
    player.inventory.forEach(item => {
      text += `${item.emoji} *${item.name}*\n`;
      text += `â”œ ${item.description}\n`;
      text += `â”” ID: ${item.id}\n\n`;
    });

    reply(text);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

// Comandos de Registro e Perfil
case 'registrar':
case 'register': {
  if (playerExists(sender)) return reply('âŒ VocÃª jÃ¡ estÃ¡ registrado no RPG! Use /perfil para ver suas informaÃ§Ãµes.');
  if (!q) return reply('âŒ Digite seu nome apÃ³s o comando. Exemplo: /registrar JoÃ£o');
  if (q.length > 20) return reply('âŒ O nome deve ter no mÃ¡ximo 20 caracteres!');
  
  try {
    const player = createPlayer(sender, q);
    reply(`âš”ï¸ *NOVO GUERREIRO REGISTRADO!* âš”ï¸\n\n_Bem-vindo Ã  sua jornada Ã©pica!_\n_Que sua lenda comece aqui..._\n\n${formatProfile(player)}`);
  } catch {
    reply('âŒ Ops! Algo deu errado no registro. Que tal tentar novamente? Pode ser seu destino se tornar um grande guerreiro! âš”ï¸');
  }
}
break;

case 'deletar':
case 'delete':
case 'deleteregister': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    deletePlayer(sender);
    reply('ğŸŒŸ *REGISTRO REMOVIDO*\n\n_Sua jornada chegou ao fim..._\n_Mas novas aventuras sempre aguardam!_ âš”ï¸');
  } catch {
    reply('âŒ NÃ£o consegui deletar seu registro... Os deuses devem ter outros planos para vocÃª! ğŸŒŸ');
  }
}
break;

case 'perfil':
case 'profile':
case 'status': {
  try {
    const target = menc_os2 || sender;
    if (!playerExists(target)) {
      return reply(target === sender ? 
        'âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.' :
        'âŒ Este usuÃ¡rio nÃ£o estÃ¡ registrado no RPG!'
      );
    }
    
    const player = getPlayer(target);
    await nazu.sendMessage(from, {
      text: formatProfile(player),
      mentions: [target]
    }, { quoted: info });
  } catch {
    reply('âŒ Os pergaminhos antigos estÃ£o um pouco confusos... NÃ£o consegui ler seu perfil agora! ğŸ“œ');
  }
}
break;

// Comandos de Economia
case 'daily':
case 'reward':
case 'recompensa': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const result = claimDaily(sender);
    reply(`ğŸ *RECOMPENSA DIÃRIA!*\n\nâœ¨ Os deuses sorriram para vocÃª hoje!\nğŸ’° VocÃª encontrou: R$ ${result.reward}\nğŸ¦ Seu novo saldo: R$ ${result.newBalance}\n\n_Volte amanhÃ£ para mais tesouros!_ ğŸ—ï¸`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'depositar':
case 'dep': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o valor que deseja depositar. Exemplo: /depositar 1000');
  
  try {
    const amount = parseInt(q);
    const result = deposit(sender, amount);
    reply(`ğŸ’ *DEPÃ“SITO REALIZADO!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’° Valor: R$ ${result.deposited}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n_Suas moedas foram guardadas em seguranÃ§a!_ ğŸ”’`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'sacar':
case 'saq': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o valor que deseja sacar. Exemplo: /sacar 1000');
  
  try {
    const amount = parseInt(q);
    const result = withdraw(sender, amount);
    reply(`ğŸ’ *SAQUE REALIZADO!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’° Valor: R$ ${result.withdrawn}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n_Suas moedas estÃ£o prontas para uso!_ ğŸ’«`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'depoall':
case 'depositartudo': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const result = depositAll(sender);
    reply(`ğŸ’ *DEPÃ“SITO TOTAL!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’° Valor: R$ ${result.deposited}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n_Todo seu tesouro foi guardado com seguranÃ§a!_ ğŸ”’`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'saqueall':
case 'sacartudo': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const result = withdrawAll(sender);
    reply(`ğŸ’ *SAQUE TOTAL!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’° Valor: R$ ${result.withdrawn}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n_Todo seu tesouro estÃ¡ em suas mÃ£os!_ ğŸ’°`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'transferir':
case 'pix': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  let targetUser;
  let amount;

  // Se marcou uma mensagem
  if (isQuotedMsg) {
    targetUser = menc_prt;
    amount = parseInt(q);
  } 
  // Se mencionou o @ e valor
  else {
    if (!menc_os2) return reply('âŒ Marque a mensagem do usuÃ¡rio ou mencione usando @');
    targetUser = menc_os2;
    amount = parseInt(q.split(' ').pop());
  }

  if (!targetUser) return reply('âŒ Marque a mensagem do usuÃ¡rio ou mencione usando @');
  if (!amount || isNaN(amount)) return reply('âŒ Digite um valor vÃ¡lido para transferir');
  
  try {
    const result = transfer(sender, targetUser, amount);
    await nazu.sendMessage(from, {
      text: `ğŸ’ *PIX REALIZADO!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’° Valor: R$ ${result.transferred}\nğŸ‘ Seu saldo: R$ ${result.fromWallet}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n_Moedas enviadas para @${targetUser.split('@')[0]} com sucesso!_ âœ¨`,
      mentions: [targetUser]
    }, { quoted: info });
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

// Comandos de Batalha e Treino
case 'treinar':
case 'train': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o atributo que deseja treinar. Exemplo: /treinar forÃ§a\n\nAtributos disponÃ­veis:\n- forÃ§a\n- defesa\n- stamina\n- vida');
  
  try {
    const result = train(sender, q);
    reply(`ğŸ‹ï¸â€â™‚ï¸ *TREINO FINALIZADO!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’ª Atributo: ${result.attribute}\nğŸ“ˆ Ganho: +${result.gained}\nâœ¨ Novo valor: ${result.newValue}\nâš¡ Energia: ${result.energy}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ“Š Level: ${result.level}\nğŸŒŸ XP: ${result.xp}\n\n_Continue treinando para se tornar mais forte!_ ğŸ’ª`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'curar':
case 'heal': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite quanto de vida deseja curar. Exemplo: /curar 50\n\nCusto: R$ 10 por ponto de vida');
  
  try {
    const amount = parseInt(q);
    if (isNaN(amount) || amount <= 0) return reply('âŒ Digite um valor vÃ¡lido para curar');
    
    const result = heal(sender, amount);
    reply(`ğŸ’– *CURA DIVINA!*\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâ¤ï¸ Vida recuperada: ${result.healed}\nğŸ’– Vida atual: ${result.newHealth}\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ’° Custo: R$ ${result.cost}\nğŸ‘ Carteira: R$ ${result.wallet}\n\n_Seus ferimentos foram curados pela energia sagrada!_ âœ¨`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'batalhar':
case 'lutar':
case 'fight': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite contra qual inimigo deseja lutar:\n\nğŸŸ¢ slime (NÃ­vel 1)\nğŸ‘º goblin (NÃ­vel 1)\nğŸ’€ skeleton (NÃ­vel 2)\nğŸº wolf (NÃ­vel 3)\nğŸ‘¹ orc (NÃ­vel 4)');
  
  try {
    const player = await checkTraining(sender);
    if (!player) return;
    const result = startBattle(sender, q.toLowerCase());
    
    // Envia o log da batalha
    let battleText = `âš”ï¸ *BATALHA INICIADA!* âš”ï¸\n\n`;
    battleText += result.log.join('\n');
    
    if (result.won) {
      battleText += `\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
      if (result.levelUp) {
        battleText += `\nğŸŠ *LEVEL UP!* ğŸŠ\n`;
        battleText += `ğŸ“Š Novo nÃ­vel: ${getPlayer(sender).level}\n`;
      }
      
      // Se ganhou novas conquistas
      if (result.newAchievements?.length > 0) {
        battleText += `\nğŸ† *NOVAS CONQUISTAS!* ğŸ†\n`;
        for (const achievement of result.newAchievements) {
          battleText += `\n${achievement.emoji} ${achievement.title}`;
          battleText += `\nâ”œ ${achievement.description}`;
          battleText += `\nâ”œ ğŸ’° +R$ ${achievement.reward.money}`;
          battleText += `\nâ”” âœ¨ +${achievement.reward.xp} XP\n`;
        }
      }
    }
    
    reply(battleText);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'pvp':
case 'duelar': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  // Verifica se marcou alguÃ©m
  if (!menc_os2) return reply('âŒ Marque o jogador que deseja desafiar!');
  
  try {
    const result = startPvpBattle(sender, menc_os2);
    
    // Envia o log da batalha
    let battleText = result.log.join('\n');
    
    // Se alguÃ©m ganhou conquistas
    if (result.newAchievements.player1?.length > 0 || result.newAchievements.player2?.length > 0) {
      battleText += `\n\nğŸ† *NOVAS CONQUISTAS!* ğŸ†\n`;
      
      // Conquistas do player 1
      for (const achievement of result.newAchievements.player1 || []) {
        battleText += `\n${achievement.emoji} ${achievement.title}`;
        battleText += `\nâ”œ ${achievement.description}`;
        battleText += `\nâ”œ ğŸ’° +R$ ${achievement.reward.money}`;
        battleText += `\nâ”” âœ¨ +${achievement.reward.xp} XP\n`;
      }
      
      // Conquistas do player 2
      for (const achievement of result.newAchievements.player2 || []) {
        battleText += `\n${achievement.emoji} ${achievement.title}`;
        battleText += `\nâ”œ ${achievement.description}`;
        battleText += `\nâ”œ ğŸ’° +R$ ${achievement.reward.money}`;
        battleText += `\nâ”” âœ¨ +${achievement.reward.xp} XP\n`;
      }
    }
    
    await nazu.sendMessage(from, {
      text: battleText,
      mentions: [sender, menc_os2]
    }, { quoted: info });
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

// Comandos de Trabalho
case 'trabalhos':
case 'jobs': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const player = getPlayer(sender);
    const jobList = formatJobList(player);
    reply(jobList);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'trabalhar':
case 'work': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const player = await checkTraining(sender);
    if (!player) return;
    const result = startWork(sender);
    let workText = `ğŸ’¼ *TRABALHO*\n\n`;
    workText += `${result.message}\n\n`;
    
    if (result.success) {
      workText += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
      workText += `ğŸ’° SalÃ¡rio: R$ ${result.rewards.money}\n`;
      workText += `âœ¨ XP: ${result.rewards.xp}\n`;
      workText += `ğŸ“ˆ XP do Trabalho: ${result.rewards.jobExp}\n`;
      
      if (result.levelUp) {
        workText += `\nğŸŠ *LEVEL UP!* ğŸŠ\n`;
        workText += `ğŸ“Š Novo nÃ­vel: ${getPlayer(sender).level}\n`;
      }
      
      if (result.promotion) {
        workText += `\nğŸ‰ *PROMOÃ‡ÃƒO!* ğŸ‰\n`;
        workText += `Ao sair do trabalho, vocÃª recebeu uma proposta!\n`;
        workText += `ğŸ’¼ Novo cargo: ${result.promotion.jobName}\n`;
        workText += `\nUse /aceitarpromocao para aceitar!`;
      }
    }
    
    reply(workText);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'emprego':
case 'contrato': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite qual emprego deseja. Use /trabalhos para ver as opÃ§Ãµes!');
  
  try {
    const job = applyForJob(sender, q.toLowerCase());
    reply(`ğŸ‰ *CONTRATADO!*\n\n_ParabÃ©ns! VocÃª foi contratado como ${job.name}!_\n\nğŸ’¼ Use /trabalhar para comeÃ§ar seu turno!`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;

case 'pedirdemissao':
case 'demitir': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const oldJob = resignFromJob(sender);
    reply(`ğŸ“„ *CARTA DE DEMISSÃƒO*\n\n_VocÃª se demitiu do cargo de ${oldJob.name}._\n\nUse /trabalhos para ver outras oportunidades!`);
  } catch (e) {
    reply('âŒ ' + e.message);
  }
}
break;
