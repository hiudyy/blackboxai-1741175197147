// Adicione essas importaÃ§Ãµes no topo do arquivo, junto com as outras:
const { playerExists, createPlayer, deletePlayer, getPlayer, savePlayer, claimDaily, formatProfile, deposit, withdraw, depositAll, withdrawAll, transfer } = require('./.funcs/.rpg/rpgFunctions.js');

// Adicione dentro do switch(command), junto com os outros comandos:

case 'registrar':
case 'register': {
  if (playerExists(sender)) return reply('âŒ VocÃª jÃ¡ estÃ¡ registrado no RPG! Use /perfil para ver suas informaÃ§Ãµes.');
  if (!q) return reply('âŒ Digite seu nome apÃ³s o comando. Exemplo: /registrar JoÃ£o');
  if (q.length > 20) return reply('âŒ O nome deve ter no mÃ¡ximo 20 caracteres!');
  
  try {
    const player = createPlayer(sender, q);
    reply(`âœ… Registro concluÃ­do com sucesso!\n\n${formatProfile(player)}`);
  } catch {
    reply('âŒ NÃ£o foi possÃ­vel fazer seu registro. Tente novamente.');
  }
}
break;

case 'deletar':
case 'delete':
case 'deleteregister': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    deletePlayer(sender);
    reply('âœ… Seu registro foi deletado com sucesso!');
  } catch {
    reply('âŒ NÃ£o foi possÃ­vel deletar seu registro.');
  }
}
break;

case 'perfil':
case 'profile':
case 'status': {
  try {
    const target = menc_os2 || sender;
    if (!playerExists(target)) {
      return reply(target === sender ? 
        'âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.' :
        'âŒ Este usuÃ¡rio nÃ£o estÃ¡ registrado no RPG!'
      );
    }
    
    const player = getPlayer(target);
    await nazu.sendMessage(from, {
      text: formatProfile(player),
      mentions: [target]
    }, { quoted: info });
  } catch {
    reply('âŒ NÃ£o foi possÃ­vel carregar o perfil.');
  }
}
break;

case 'daily':
case 'reward':
case 'recompensa': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const result = claimDaily(sender);
    reply(`âœ¨ *Recompensa DiÃ¡ria Coletada!*\n\nğŸ’° VocÃª recebeu: R$ ${result.reward}\nğŸ¦ Novo saldo: R$ ${result.newBalance}`);
  } catch {
    reply('âŒ VocÃª jÃ¡ coletou sua recompensa hoje! Volte amanhÃ£.');
  }
}
break;

case 'depositar':
case 'dep': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o valor que deseja depositar. Exemplo: /depositar 1000');
  
  try {
    const amount = parseInt(q);
    const result = deposit(sender, amount);
    reply(`âœ… *DepÃ³sito realizado com sucesso!*\n\nğŸ’° Valor: R$ ${result.deposited}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}`);
  } catch {
    reply('âŒ Digite um valor vÃ¡lido para depositar!');
  }
}
break;

case 'sacar':
case 'saq': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  if (!q) return reply('âŒ Digite o valor que deseja sacar. Exemplo: /sacar 1000');
  
  try {
    const amount = parseInt(q);
    const result = withdraw(sender, amount);
    reply(`âœ… *Saque realizado com sucesso!*\n\nğŸ’° Valor: R$ ${result.withdrawn}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}`);
  } catch {
    reply('âŒ Digite um valor vÃ¡lido para sacar!');
  }
}
break;

case 'depoall':
case 'depositartudo': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const result = depositAll(sender);
    reply(`âœ… *DepÃ³sito total realizado com sucesso!*\n\nğŸ’° Valor: R$ ${result.deposited}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}`);
  } catch {
    reply('âŒ VocÃª nÃ£o tem dinheiro na carteira para depositar!');
  }
}
break;

case 'saqueall':
case 'sacartudo': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  try {
    const result = withdrawAll(sender);
    reply(`âœ… *Saque total realizado com sucesso!*\n\nğŸ’° Valor: R$ ${result.withdrawn}\nğŸ‘ Carteira: R$ ${result.newWallet}\nğŸ¦ Banco: R$ ${result.newBank}`);
  } catch {
    reply('âŒ VocÃª nÃ£o tem dinheiro no banco para sacar!');
  }
}
break;

case 'transferir':
case 'pix': {
  if (!playerExists(sender)) return reply('âŒ VocÃª nÃ£o estÃ¡ registrado no RPG! Use /registrar para comeÃ§ar.');
  
  let targetUser;
  let amount;

  // Se marcou uma mensagem
  if (isQuotedMsg) {
    targetUser = menc_prt;
    amount = parseInt(q);
  } 
  // Se mencionou o @ e valor
  else {
    if (!menc_os2) return reply('âŒ Marque a mensagem do usuÃ¡rio ou mencione usando @');
    targetUser = menc_os2;
    amount = parseInt(q.split(' ').pop());
  }

  if (!targetUser) return reply('âŒ Marque a mensagem do usuÃ¡rio ou mencione usando @');
  if (!amount || isNaN(amount)) return reply('âŒ Digite um valor vÃ¡lido para transferir');
  
  try {
    const result = transfer(sender, targetUser, amount);
    await nazu.sendMessage(from, {
      text: `âœ… *TransferÃªncia realizada com sucesso!*\n\nğŸ’° Valor: R$ ${result.transferred}\nğŸ‘ Seu saldo: R$ ${result.fromWallet}\n\n_TransferÃªncia feita para @${targetUser.split('@')[0]}_`,
      mentions: [targetUser]
    }, { quoted: info });
  } catch {
    reply('âŒ NÃ£o foi possÃ­vel realizar a transferÃªncia. Verifique se o usuÃ¡rio estÃ¡ registrado e se vocÃª tem saldo suficiente.');
  }
}
break;
